#!/usr/bin/env -S ruby -I lib -w
# frozen_string_literal: true

require 'uri/gemini'
require 'net/gemini'


u = URI(ARGV[0])
response = Net::Gemini.start(u.host, u.port) do |g|
  g.fetch(u)
end
puts response.body(flowed: 78)
puts "\n* Headers"
puts "#{response.status} - #{response.meta}"
response.header.each do |k, v|
  puts "- #{k} :: #{v}"
end
puts "\n* Links"
links = response.links.map do |l|
  if l[:label]
    "- #{l[:label]}: #{l[:uri]}"
  else
    "- #{l[:uri]}"
  end
end
puts links.join("\n")
